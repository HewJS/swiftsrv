angular.module("sqrtl.adventure",[]).controller("AdventureController",function(a,b,c,d){a.data=JSON.parse(window.localStorage.getItem("data"))[0],console.log(a.data),a.getNew=function(){c.dataShift(),a.data=JSON.parse(window.localStorage.getItem("data"))[0]},a.getUber=function(a){console.log("location coords ",a),window.localStorage.setItem("latitude",a.latitude.toString()),window.localStorage.setItem("longitude",a.longitude.toString()),c.getUber().then(function(a){console.log("redirect URL ",a),d.location.href=a})},a.address={long:a.data.location.coordinate.longitude,lat:a.data.location.coordinate.latitude,templateUrl:"http://maps.google.com/maps?q="+a.data.location.coordinate.latitude+","+a.data.location.coordinate.longitude},a.googleRedirect=function(){console.log(a.address.templateUrl),d.location.href=a.address.templateUrl}}),angular.module("sqrtl",["sqrtl.httpRequest","sqrtl.auth","sqrtl.form","sqrtl.adventure","sqrtl.uber","ui.router","ngRoute","ui.bootstrap"]).config(function(a,b){b.when("auth","/auth").when("uber","/uber").otherwise("/form"),a.state("form",{url:"/form",templateUrl:"app/form/form.html",controller:"FormController"}).state("adventure",{url:"/adventure",templateUrl:"app/adventureLand/Adventure.html",controller:"AdventureController"}).state("auth",{url:"/auth",templateUrl:"app/auth/auth.html",controller:"AuthController"}).state("uber",{url:"/uber",templateUrl:"app/uber/uber.html",controller:"UberController"})}),angular.module("sqrtl.auth",[]).controller("AuthController",function(a,b,c){a.login=function(){console.log("called in auth"),b.authGoogle().then(function(a){console.log("redirect URL ",a),c.location.href=a})}}),angular.module("sqrtl.form",[]).controller("FormController",function(a,b,c){a.adventure={},a.getLocationAndCategory=function(d,e){c.requestAdventures(d,e).then(function(a){return console.log(a),!0}).then(function(){a.data=window.localStorage.getItem("data")[0]}).then(function(){b.go("adventure")})}}),angular.module("sqrtl.httpRequest",[]).factory("Adventures",function(a){var b=function(b,c){var d="/api/getYelp";return a({method:"POST",url:d,data:JSON.stringify({term:c,location:b})}).then(function(a){return data=a.data.businesses.map(function(a){return{name:a.name,image:a.image_url.replace(/ms.jpg/i,"o.jpg"),isClosed:a.is_closed,rating:a.rating,ratingImg:a.rating_img_url,reviewCount:a.review_count,snippet:a.snippet,location:a.location}}),window.localStorage.setItem("data",JSON.stringify(data)),data=JSON.parse(window.localStorage.getItem("data")),data}).catch(function(a){console.error(a)})},c=function(){return data=JSON.parse(window.localStorage.getItem("data")),shiftedData=data.shift(),window.localStorage.setItem("data",JSON.stringify(data)),console.log(JSON.parse(window.localStorage.getItem("data"))),shiftedData},d=function(){return a({method:"GET",url:"/api/getUber"}).then(function(a){return a.data})},e=function(b){return a({method:"POST",url:"api/uberPrice",data:JSON.stringify(b)}).then(function(a){return a.data})},f=function(b){return a({method:"POST",url:"api/uberRide",data:JSON.stringify(b)}).then(function(a){return a.data})},g=function(){return console.log("called in http"),a({method:"GET",url:"/api/authGoogle"}).then(function(a){return console.log(a),a.data})};return{requestAdventures:b,dataShift:c,getUber:d,uberPrice:e,uberRide:f,authGoogle:g}}),angular.module("sqrtl.uber",[]).controller("UberController",function(a,b){a.geo=navigator.geolocation,a.geoFindMe=function(b){a.geo.getCurrentPosition(function(a){b(a)})},a.getPrice=function(){a.trip={start_lat:a.current.latitude,start_long:a.current.longitude,final_lat:a.destination.latitude,final_long:a.destination.longitude},b.uberPrice(a.trip).then(function(b){console.log("price ",b),a.priceArray=b.prices})},a.getRide=function(c){a.trip.productId=c,console.log("trip ",a.trip),b.uberRide(a.trip).then(function(a){console.log("ride ",a)})},a.geoFindMe(function(b){a.$apply(function(){a.current={latitude:b.coords.latitude,longitude:b.coords.longitude},a.destination={latitude:window.localStorage.getItem("latitude"),longitude:window.localStorage.getItem("longitude")},console.log(a.current),console.log(a.destination)})})});